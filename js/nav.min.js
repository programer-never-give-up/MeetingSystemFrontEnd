function checkLogin(isRedirect,loginStatusToRedirect=false){$.get('api/check/',function(data){if(data.status){if(isRedirect){if(loginStatusToRedirect)
{window.location.href="index.html";return;}}
var navList=$('.nav-list');navList.parent().css('position','relative');navList.before(generateSearchBar(navList.parent(),function(resultDiv,keyword){searchCallBack(resultDiv,keyword);}));navList.append('<a href="console.html" class="nav-list-item">控制台</a>');navList.append('<a href="Personal_Center.html" class="nav-list-item">个人中心</a>');navList.append('<span style="color: #ff5722;" class="nav-list-item">'+'<i class="fas fa-power-off"></i>'+'<a href="#" onclick="logout()">退出</a>'+'</span>');navList.prev().css('right',navList.outerWidth()+30);if(data['type']==0){$('a.business-user').hide();$('button.business-user').addClass('disabled');$('button.business-user').attr('disabled',true);}else if(data['type']==1){$('a.business-user').show();$('button.business-user').removeClass('disabled');$('button.business-user').attr('disabled',false);}}else{if(isRedirect){if(!loginStatusToRedirect){window.location.href="index.html";return;}}
var navList=$('.nav-list');navList.parent().css('position','relative');navList.before(generateSearchBar(navList.parent(),function(resultDiv,keyword){searchCallBack(resultDiv,keyword);}));navList.append('<a href="login.html" class="nav-list-item">登录</a>');navList.append('<a href="register.html" class="nav-list-item">注册</a>');navList.prev().css('right',navList.outerWidth()+30);}});}
function logout(){$.get('api/logout/',function(data){if(data.status){console.log('登出成功');window.location.href='index.html';}else{console.log('登出失败')}});}
function toastMessage(message){if($(".toast").length<=0){let toast="<div class=\"toast w-25\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\" data-delay=\"2000\" id=\"message-box\">\n"+"    <div class=\"toast-header bg-danger text-white\">\n"+"        <strong>提示</strong>\n"+"    </div>\n"+"    <div class=\"toast-body p-3\" id=\"message\">\n"+"    </div>\n"+"</div>";$(".navbar").after(toast);}
$('#message').text(message);$('.toast').toast('show');}
function jump(seconds,message,url){var timeOut=seconds;window.setInterval(function(){if(timeOut>0){toastMessage(message+" "+timeOut+"秒");timeOut--;}else{window.clearInterval();window.location.href=url;}},1000)}
function getParameter(){var url=window.location.search;var parameters=new Object();if(url.indexOf("?")!=-1){var str=url.substr(1);strs=str.split("&");for(var i=0;i<strs.length;i++){parameters[strs[i].split("=")[0]]=decodeURI(strs[i].split("=")[1]);}}
return parameters;}
function checkRequired(className){flag=true;$('.'+className).each(function(index,element){if($(this).val()==""||$(this).val()==undefined||$(this).val()==null){flag=false;}});return flag;}
function generateSearchBar($fatherObject,callbackFun=null,minWidth=310){$searchDic=$('<div class="input-group search-box" id="search-background"></div>');$searchIcon=$('<img class="search-icon"></img>');$searchIcon.attr('src',"images/icons/search.png");$searchDic.append($searchIcon);$searchInput=$('<input type="text" list="search-result-list" placeholder="搜索" class="search-input" id="search-input">')
$searchDic.append($searchInput);$resultDiv=$('<div class="card result-card" >\n'+'                <div class="card-body">\n'+'                    <table class="table table-hover table-borderless">\n'+'                       <tbody id="search-result-body">\n'+'            \n'+'                       </tbody>\n'+'                   </table>\n'+'               </div>\n'+'          </div>');$resultDiv.hide();$searchDic.append($resultDiv);$searchInput.on('focus',function(){var maxWidth=$fatherObject.width()-$fatherObject.children('*').eq(0).outerWidth()-$fatherObject.children('*').eq(2).outerWidth()-40;$searchInput.parent().animate({width:maxWidth,},300,function(){$searchInput.css('width','700px')});$searchInput.animate({width:maxWidth-50,},300);searchCallBack($resultDiv,$searchInput.val());});$('body').bind('click',function(event){if(event.target.id!='search-input'&&event.target.id!="search-result-body"&&event.target.id!='search-background'){$searchInput.parent().animate({width:minWidth,},300);$searchInput.animate({width:minWidth-50,},300);$resultDiv.hide();}});$searchInput.bind('input propertychange',function(){callbackFun($resultDiv,$searchInput.val());});return $searchDic;}
function searchCallBack($resultDiv,keyword){if(keyword==''||keyword==null||keyword==undefined){return;}
$.ajax({type:'GET',data:{keyword:keyword},url:"api/yw/search/",dataType:'json',success:function(data){var $rusultBody=$resultDiv.find('tbody');$rusultBody.find('*').remove();console.log(data);toastMessage(data['message']);activitys=data['list_activity'];if(activitys.length>0){for(let i=0;i<activitys.length;i++){activity=activitys[i];var $activityRow=$('<tr style="display: flex;align-items:center; ">\n'+'    <td></td>\n'+'    <td></td>\n'+'    <td></td>\n'+'    <td></td>\n'+'</tr>')
$activityRow.find('td').eq(0).append('<img style="width: 40px;height: 40px"  src="'+activity['logo']+'">');$activityRow.find('td').eq(1).append('<a href="show_meeting_info.html?id='+activity['uuid_act']+'">'+activity['name_act']+'</a>');$activityRow.find('td').eq(2).text(activity['location']);$activityRow.find('td').eq(3).text(activity['start_time']+' —— '+activity['end_time']);$rusultBody.append($activityRow);}
$resultDiv.show();}},error:function(){toastMessage('搜索失败');}})}